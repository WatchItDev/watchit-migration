# On Cloudflare, go to Crypto -> SSL and set it to Full or Full(strict)
{
	email info@watchit.movie
    debug
}

(cors) {
        @cors_preflight{args.0} method OPTIONS
        @cors{args.0} header Origin {args.0}

        handle @cors_preflight{args.0} {
                header {
                        Access-Control-Allow-Origin "{args.0}"
                        Access-Control-Allow-Methods "GET, POST, PUT, PATCH, DELETE, OPTIONS"
                        Access-Control-Allow-Headers *
                        Access-Control-Max-Age "3600"
                        defer
                }
                respond "" 204
        }

        handle @cors{args.0} {
                header {
                        Access-Control-Allow-Origin "{args.0}"
                        Access-Control-Expose-Headers *
                        defer
                }
        }
}


(shared_conf) {
    encode zstd gzip

	log {
		output stdout
    }
}

gw.watchit.movie {
    import shared_conf
    import cors *
    tls /etc/caddy/cert.pem /etc/caddy/key.pem
    reverse_proxy :8080   
    
}