# On Cloudflare, go to Crypto -> SSL and set it to Full or Full(strict)

{
	email info@watchit.movie
    debug
}


(security_headers) {
    header * {
		# enable HSTS
		# https://cheatsheetseries.owasp.org/cheatsheets/HTTP_Headers_Cheat_Sheet.html#strict-transport-security-hsts
        Strict- Transport - Security "max-age=3600; includeSubDomains; preload"

		# disable clients from sniffing the media type
		# https://cheatsheetseries.owasp.org/cheatsheets/HTTP_Headers_Cheat_Sheet.html#x-content-type-options
    X - Content - Type - Options "nosniff"

		# clickjacking protection
		# https://cheatsheetseries.owasp.org/cheatsheets/HTTP_Headers_Cheat_Sheet.html#x-frame-options
    X - Frame - Options "DENY"

		# xss protection
		# https://cheatsheetseries.owasp.org/cheatsheets/HTTP_Headers_Cheat_Sheet.html#x-xss-protection
    X - XSS - Protection "1; mode=block"

		# Remove - Server header, which is an information leak
		# Remove Caddy from Headers
        - Server

		# keep referrer data off of HTTP connections
		# https://cheatsheetseries.owasp.org/cheatsheets/HTTP_Headers_Cheat_Sheet.html#referrer-policy
    Referrer - Policy strict - origin - when - cross - origin
}
}


(shared_conf) {
    import security_headers
    tls internal
    encode zstd gzip

	log {
		output stdout
    }
}


gw.watchit.movie /ipfs/* {
    import shared_conf
    
    header {
        Host {host}
        X-Real-IP {remote}
        X-Forwarded-Proto {scheme}
        Access-Control-Allow-Origin *
        Access-Control-Allow-Credentials true
        Access-Control-Allow-Methods *
        Access-Control-Allow-Headers *
        defer
    }

    reverse_proxy  locahost:8000 {
        header_up Host {http.reverse_proxy.upstream.hostport}
        header_up X-Forwarded-Proto {scheme}
    }    
    
}